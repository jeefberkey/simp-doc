

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>4.5. Hiera Overview &mdash; SIMP 5.2.1-0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="https://media.readthedocs.org/css/sphinx_rtd_theme.css" type="text/css" />
  
    <link rel="stylesheet" href="https://media.readthedocs.org/css/readthedocs-doc-embed.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/css_overrides.css" type="text/css" />
  

  
    <link rel="top" title="SIMP 5.2.1-0 documentation" href="../index.html"/>
        <link rel="up" title="4. SIMP User Guide" href="index.html"/>
        <link rel="next" title="4.6. Troubleshooting Common Issues" href="Troubleshooting.html"/>
        <link rel="prev" title="4.4.3. Managing SSSD LOCAL Domain And Users" href="User_Management/SSSD.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="../index.html">
        

        
          
          <img src="../_static/SIMP_Logo.png" class="logo" />
        
        </a>

        
          
          
            <div class="version">
              5.2.1
            </div>
          
        

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Welcome to the SIMP documentation!</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started_guide/Just_Install.html">1. For the Impatient</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dynamic/Changelog.html">2. Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started_guide/index.html">3. Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">4. User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Introduction.html">4.1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="Client_Management.html">4.2. Client Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="SIMP_Administration.html">4.3. General Administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="User_Management.html">4.4. User Management</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">4.5. Hiera Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#setting-parameters">4.5.1. Setting Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#assigning-classes-to-nodes">4.5.2. Assigning Classes to Nodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#assigning-defined-types-to-nodes">4.5.3. Assigning Defined Types to Nodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#simp-hiera-file-structure">4.5.4. SIMP Hiera File Structure</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Troubleshooting.html">4.6. Troubleshooting Common Issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="HOWTO.html">4.7. SIMP HOWTO Guides</a></li>
<li class="toctree-l2"><a class="reference internal" href="SIMP_Package_Data.html">4.8. Package Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#indices-and-tables">4.9. Indices and tables</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../contributors_guide/index.html">5. Contributing to SIMP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security_conop/index.html">6. Security Concept of Operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security_mapping/index.html">7. Security Control Mapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../help/index.html">8. Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">9. License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html#contact">10. Contact</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">11. Glossary of Terms</a></li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">SIMP</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">4. SIMP User Guide</a> &raquo;</li>
      
    <li>4.5. Hiera Overview</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/user_guide/Hiera_Overview.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="hiera-overview">
<span id="hiera"></span><h1>4.5. Hiera Overview<a class="headerlink" href="#hiera-overview" title="Permalink to this headline">¶</a></h1>
<p>SIMP uses Hiera to assign classes to nodes. From the Puppet, Inc
website: Hiera is a key/value lookup tool for configuration data, built
to set node-specific data without repeating yourself. It is an attempt
to make SIMP more configurable to you, the end user. It configures
Puppet in two ways: automatic parameter lookup/hiera lookup functions,
and assigning classes to nodes. The former allows you to generate
reusable code and concentrates parameter assignment to one directory.
The latter is a supplement to the failed inheritance model.</p>
<div class="section" id="setting-parameters">
<h2>4.5.1. Setting Parameters<a class="headerlink" href="#setting-parameters" title="Permalink to this headline">¶</a></h2>
<p><strong>Automatic Lookup</strong> You can now safely declare any class on any node
with &#8216;include&#8217;, even if the class is parameterized. Before Hiera, this was
not possible. Puppet will automatically retrieve class parameters from
Hiera using keys. Add a key with a value pair to an appropriate yaml
file, say default.yaml, as such:</p>
<p>Adding a Key/Value Pair to Hiera Examples</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="l l-Scalar l-Scalar-Plain">classfoo::parameter_bar</span><span class="p p-Indicator">:</span> <span class="s">&quot;Woo&quot;</span>
<span class="l l-Scalar l-Scalar-Plain">classfoo::parameter_baz</span><span class="p p-Indicator">:</span> <span class="s">&quot;Hoo&quot;</span>
</pre></div>
</div>
<p>You can then &#8216;include classfoo&#8217; on any node, with parameter_bar and
parameter_baz defaulting to Woo and Hoo, respectively.</p>
<p><strong>Lookup Functions</strong> You are not required to set up your hierarchy for
automatic variable lookup. Using three functions, you can query Hiera
for any key.</p>
<p>The first is <code class="docutils literal"><span class="pre">hiera</span></code>. This uses standard priority lookup and can
retrieve values of any data type from Hiera. If no key is found, a
default should be included. <code class="docutils literal"><span class="pre">$myvar</span> <span class="pre">=</span> <span class="pre">hiera('parameter_bar',</span> <span class="pre">'Woo')</span></code></p>
<p>The second is <code class="docutils literal"><span class="pre">hiera_array</span></code>. This uses an array merge lookup. It
retrieves all array values for a given key throughout the entire
hierarchy and flattens them into a single array.</p>
<p>The third is <code class="docutils literal"><span class="pre">hiera_hash</span></code>. This uses a hash merge lookup. It retrieves
all hash values for a given key throughout the entire hierarchy and
merges them into a single hash.</p>
</div>
<div class="section" id="assigning-classes-to-nodes">
<h2>4.5.2. Assigning Classes to Nodes<a class="headerlink" href="#assigning-classes-to-nodes" title="Permalink to this headline">¶</a></h2>
<p>Assigning classes to nodes is done with the <code class="docutils literal"><span class="pre">hiera_include</span></code> function.
Hiera does an array merge lookup on &#8216;tags&#8217; to retrieve classes which
should be included on a node. In SIMP, we place
<code class="docutils literal"><span class="pre">hiera_include('classes')</span></code> in <code class="docutils literal"><span class="pre">/etc/puppetlabs/code/environments/simp/manifests/site.pp</span></code>. Since
site.pp is outside of any node definition and below all top scope
variables, every node controlled by puppet will get every class tagged
with &#8216;classes&#8217; <strong>in its hierarchy</strong>. Additionally, simp_def.yaml is in
the hierarchy of every node, so every node will receive those classes
(by default).</p>
</div>
<div class="section" id="assigning-defined-types-to-nodes">
<h2>4.5.3. Assigning Defined Types to Nodes<a class="headerlink" href="#assigning-defined-types-to-nodes" title="Permalink to this headline">¶</a></h2>
<p>Defined types do not have the ability to receive parameters via Hiera in
the traditional sense. To include a defined type on a node, one could
use create_resources, but this is messy and discouraged. Instead, make a
site class <code class="docutils literal"><span class="pre">/etc/puppetlabs/code/environments/simp/modules/site/manifests/my_site.pp</span></code>.
For example, to include tftpboot linux_model and assign_host on your
puppet server, puppet.your.domain:</p>
<p>Add the following code to a file tftpboot.pp in your site/manifests directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1"># in /etc/puppetlabs/code/environments/simp/modules/site/manifests/tftpboot.pp</span>
<span class="c1"># Set KSSERVER statically or use Hiera for lookup</span>

<span class="k">class</span> <span class="n">site</span><span class="o">::</span><span class="n">tftpboot</span> <span class="p">{</span>
  <span class="kp">include</span> <span class="s1">&#39;tftpboot&#39;</span>

  <span class="n">tftpboot</span><span class="o">::</span><span class="n">linux_model</span> <span class="p">{</span> <span class="s1">&#39;EL_MAJOR_VERSION&#39;</span><span class="p">:</span>
    <span class="n">kernel</span> <span class="o">=&gt;</span> <span class="s1">&#39;EL_MAJOR_VERSION_x86_64/vmlinuz&#39;</span><span class="p">,</span>
    <span class="n">initrd</span> <span class="o">=&gt;</span> <span class="s1">&#39;EL_MAJOR_VERSION_x86_64/initrd.img&#39;</span><span class="p">,</span>
    <span class="n">ks</span>     <span class="o">=&gt;</span> <span class="s2">&quot;https://KSSERVER/ks/pupclient_x86_64.cfg --noverifyssl inst.noverifyssl&quot;</span><span class="p">,</span>
    <span class="n">extra</span>  <span class="o">=&gt;</span> <span class="s1">&#39;ipappend 2&#39;</span>
  <span class="p">}</span>

  <span class="n">tftpboot</span><span class="o">::</span><span class="n">assign_host</span> <span class="p">{</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="n">model</span> <span class="o">=&gt;</span> <span class="s1">&#39;EL_MAJOR_VERSION&#39;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Then add the following code to your servers Hiera file,</dt>
<dd><code class="docutils literal"><span class="pre">/etc/puppetlabs/code/environments/simp/hieradata/hosts/puppet.your.domain.yaml</span></code></dd>
</dl>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="l l-Scalar l-Scalar-Plain">classes</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="s">&#39;site::tftpboot&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="simp-hiera-file-structure">
<h2>4.5.4. SIMP Hiera File Structure<a class="headerlink" href="#simp-hiera-file-structure" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">/etc/puppetlabs/puppet/hiera.yaml</span></code> Hiera&#8217;s config file, used to control the
hierarchy of your backends.</li>
<li><code class="docutils literal"><span class="pre">/etc/puppetlabs/code/environments/simp/hieradata/</span></code> Default location of the yaml files which
contain your node data</li>
<li><code class="docutils literal"><span class="pre">/etc/puppetlabs/code/environments/simp/hieradata/simp/simp.yaml</span></code> The list of default classes
to include on any SIMP system.</li>
<li><code class="docutils literal"><span class="pre">/etc/puppetlabs/code/environments/simp/hieradata/simp/site/*.yaml</span></code> Contains the variables needed to
configure a working SIMP system. Added by simp-config.</li>
<li><code class="docutils literal"><span class="pre">/etc/puppetlabs/code/environments/simp/hieradata/hosts/</span></code> By populating this directory with
some.host.name.yaml file, you can assign parameters to host some.host.name</li>
<li><code class="docutils literal"><span class="pre">/etc/puppetlabs/code/environments/simp/hieradata/domains/</span></code> Same principal as hosts, but domain
names.</li>
<li><code class="docutils literal"><span class="pre">/etc/puppetlabs/code/environments/simp/hieradata/hostgroups/</span></code> The hostgroup of a node can be computer
in <cite>site.pp</cite>. Nodes assigned to hostgroup <cite>$hostgroup</cite> will read hiera from a file named
<cite>$hostgroup.yaml</cite> in this directory.</li>
<li><code class="docutils literal"><span class="pre">/etc/puppetlabs/code/environment/simp/manifests/</span></code> Contains site.pp and all other node manifests.
BE CAREFUL when modifying this directory, site.pp contains your globals.
This directory can be used to supplement or even REPLACE Hiera, with
nodes. Note that Hiera cannot regex hostnames to apply manifests, so a
node manifest will have to be created here if you wish to have that
ability.</li>
</ul>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Troubleshooting.html" class="btn btn-neutral float-right" title="4.6. Troubleshooting Common Issues" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="User_Management/SSSD.html" class="btn btn-neutral" title="4.4.3. Managing SSSD LOCAL Domain And Users" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, THE SIMP TEAM.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'4.2.X',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>